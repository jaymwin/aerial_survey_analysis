---
title: "Summary of the `r params$year` Wisconsin Spring Waterfowl Survey"
author:  |
  | Drew Fowler
  | *Office of Applied Science*
  | *Wisconsin Department of Natural Resources*
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 12pt
geometry: margin = 1in
header-includes:
  - \usepackage{booktabs}
  - \usepackage{colortbl}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{makecell}
params: 
  year: 
bibliography: survey_citations.bib
csl: the-journal-of-wildlife-management
output: 
  pdf_document:
    fig_caption: yes
# always_allow_html: true
---

```{r, echo = FALSE, warning = FALSE, message = FALSE}
source(here::here('scripts/rmarkdown_functions.R'))
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# automate some parts of report text with previous year, number of study years
previous_year <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'ws_structured.csv')) %>%
  distinct(year) %>%
  slice_tail(n = 2) %>%
  slice(1) %>%
  pull()
missing_years <- 1 # due to covid
num_survey_years <- length(seq(1973, analysis_year, 1)) - missing_years
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# wetland summary statistics
# reported in text below
extract_wetland_statistics(region_code = 1)
extract_wetland_statistics(region_code = 2)
extract_wetland_statistics(region_code = 3)
extract_wetland_statistics(region_code = 4)

sec_results <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'wetland_summary_region_1.csv'))
nhi_results <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'wetland_summary_region_2.csv'))
nlo_results <-read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'wetland_summary_region_3.csv'))
swd_results <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'wetland_summary_region_4.csv'))
```

## Overview

The Wisconsin Department of Natural Resources flew the Aerial Spring Breeding Waterfowl Survey in `r params$year` following a suspension in data collection in 2020 due to the COVID-19 pandemic. This suspension resulted in the first gap of survey data since data collection began in 1973. In this report I summarize results from the `r params$year` survey including survey counts of priority waterfowl species and total wetlands, which the latter are used as a proxy for habitat availability and conditions. In addition to the summary statistics and graphics that follow in this report, I first offer two notable discussion points: 1) the sensitivity to survey estimates when Visibility Correction Factors (VCF) fluctuate annually and 2) newly incorporated statistically modeled population estimates that buffer observation error in the survey.  

## Sensitivity to survey estimates resulting from variability in the VCF

Estimates for breeding waterfowl species are derived for a given region by multiplying three parameters:  1) The density of birds per square mile, 2) the square area of the region and 3) the VCF. Of the three parameters, two require annual calculation. Briefly, density of a given species is estimated based on the total number of individuals counted along transects, given the square area of the transects. The VCF is calculated for each species as the ratio of individuals counted on ground transects to the number counted on the same transect but by air. By example, if a summary count of individuals for a given species was 115 on ground transects, but 65 on air transects, the VCF would be 1.77. Therefore, if 2.05 individuals / mi^2^ were counted on air transect across an entire region encompassing 20,000 mi^2^, then the survey population would be: 2.05 individuals /mi^2^ (Density) * 20,000 mi^2^ (Area) * 1.77 (VCF) and would result in 72,570 breeding waterfowl. Therefore, the VCF serves as a direct multiplier to the population estimate calculated using air observations alone. As a result, substantial annual changes in the VCF can have profound effects on the population estimate (Example estimate is 41,000 when VCF = 1 and 82,000 when VCF = 2). Deriving a VCF from a group of transects that is representative of the overall survey area is imperative and standard operating procedure accepts VCF with a coefficient of variation (CV) <20%, which is a standardized measure of dispersion. To achieve VCFs with acceptable CV levels, the minimum number of multiple years of survey data are included in the calculation until a CV of less than 20% is realized. Importantly, the number of years required varies annually across and within priority species. In `r params$year`, the VCF for mallards dropped from 1.659 in 2019 to 1.132 in `r params$year`. Though bird density per square mile remained relatively the same in `r params$year` compared to 2019, the lower VCF for `r params$year` resulted in a much lower total mallard population estimate. The reason for such a lower VCF in `r params$year` stems from the near identical count of mallards by ground observers (n = 188) as air observers (n = 186) in `r params$year`. Historically counts have been much more disparate (see Figures \ref{fig:mall_air_ground}--\ref{fig:other_air_ground}), with ground observers counting more than air observers. Combined with the fact that VCF for mallards generally require only two years of data to meet an acceptable CV < 20% and that the 2019 VCF was based on increased parity in ground and air counts, the `r params$year` VCF was one of the lowest VCFs for mallards in the last 20 years. Increased parity in air and ground counts could be the result of many speculative factors, but could include: improved detection from air observers because of gained experience, improved detection from air observers because of environmental factors like wetland availability that concentrate birds in detectable landscapes, or decreased detection from ground observers (note: the survey assumes perfect detection from ground observers). Irrespective of the mechanism, understanding the sensitivity of population estimates to changes in VCF is important context when interpreting this yearâ€™s mallard population estimate. 

## State-space model population estimates

Because annual spring breeding survey estimates are an unknown integration of both true annual population change and observation error, I elected to model all annual estimates for each priority species using a state-space modeling approach. State-space models are hierarchical models that decompose an observed time series of counts into a process variation (true population size change) and an observation error component (survey count biases). I followed a density-independent approach and details of the modeling process can be found in @kery2012bayesian. State-space models offer at least two important advantages. First, modeled survey estimates smooth out drastic annual changes in raw survey estimates that are biologically unrealistic (i.e., mallard abundance changing from roughly 250K in 1999, to 450K in 2000, and then to 180K in 2001). Secondly, a Bayesian state-space model allows for estimate prediction, even when counts are unavailable. In light of missing data for 2020, modeled estimates are available to fill in the gap. Therefore, in the following summaries of priority breeding waterfowl estimates, I reference abundance and percent changes in light of the modeled survey estimates rather than the raw survey estimates, but provide both in the tables and figures for comparison. It is my recommendation that Wildlife Management staff present both the modeled survey estimates along with the raw survey estimates, and not the raw survey estimates by themselves. Accordingly, the annual report should explain what the state-space model does and why it was used.

## Wetlands 

Total non-linear basins were `r sec_results$direction_previous_non_linear` `r sec_results$percent_change_previous_non_linear` from `r previous_year` in the SEC (Table \ref{tab:wetland_tab_sec}; Figure \ref{fig:wetland_abundance_sec}) but still 19% above the long-term (`r params$year - 1973 - 1`-yr) mean, `r nhi_results$direction_previous_non_linear` `r nhi_results$percent_change_previous_non_linear` from `r previous_year` in the NHI (Table \ref{tab:wetland_tab_nhi}; Figure \ref{fig:wetland_abundance_nhi}) and 25% above the long-term mean, and `r nlo_results$direction_previous_non_linear` `r nlo_results$percent_change_previous_non_linear` from `r previous_year` in the NLO (Table \ref{tab:wetland_tab_nlo}; Figure \ref{fig:wetland_abundance_nlo}) but still 39% above the long-term mean. Non-linear basins were `r swd_results$direction_previous_non_linear` `r swd_results$percent_change_previous_non_linear` from `r previous_year` in the SWD (Table \ref{tab:wetland_tab_swd}; Figure \ref{fig:wetland_abundance_swd}) and below 4% compared to this region's long-term (23-yr) mean.  

Total linear basins were `r sec_results$direction_previous_linear` `r sec_results$percent_change_previous_linear` from `r previous_year` in the SEC (Table \ref{tab:wetland_tab_sec}; Figure \ref{fig:wetland_abundance_sec}) and 27% above the long-term mean, `r nhi_results$direction_previous_linear` `r nhi_results$percent_change_previous_linear` from `r previous_year` in the NHI (Table \ref{tab:wetland_tab_nhi}; Figure \ref{fig:wetland_abundance_nhi}) and 33% above the long-term mean, and `r nlo_results$direction_previous_linear` `r nlo_results$percent_change_previous_linear` from `r previous_year` in the NLO and 48% above the long-term mean (Table \ref{tab:wetland_tab_nlo}; Figure \ref{fig:wetland_abundance_nlo}). Total linear basins were `r swd_results$direction_previous_linear` `r swd_results$percent_change_previous_linear` from `r previous_year` in the SWD and 38% above the long-term mean (Table \ref{tab:wetland_tab_swd}; Figure \ref{fig:wetland_abundance_swd}).   

## Survey timing  

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# these will be updated later to pull from a csv or .csv object
air_start_date <- as.Date('2021-04-26')
air_end_date <- as.Date('2021-05-07')
ground_start_date <- as.Date('2021-04-27')
ground_end_date <- as.Date('2021-05-07')

num_air_days <- length(seq(air_start_date, air_end_date, by = 'day'))
num_ground_days <- length(seq(ground_start_date, ground_end_date, by = 'day'))
```

In `r params$year`, the air survey was done in `r num_air_days` days (`r str_c(format(air_start_date, '%B %d'))`--`r str_c(format(air_end_date, '%B %d'))`). The ground survey was done in `r num_ground_days` days that spanned `r str_c(format(ground_start_date, '%B %d'))`--`r str_c(format(ground_end_date, '%B %d'))`. The ground counts were all done within 2 days of the air survey (16 transects +1 day and 4 transects +2 days). 

## Ducks and Geese  

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# state-space model estimates for waterfowl species
# reported in text below
mall_results <- extract_state_space_statistics(spp = 'mallard')
bwte_results <- extract_state_space_statistics(spp = 'blue-winged teal')
wodu_results <- extract_state_space_statistics(spp = 'wood duck')
other_results <- extract_state_space_statistics(spp = 'other ducks')
all_results <- extract_state_space_statistics(spp = 'total ducks')
cago_results <- extract_state_space_statistics(spp = 'canada goose')
swan_results <- extract_state_space_statistics(spp = 'trumpeter swan')
```

Ten flocks of groups over 10 mallards were encountered (One group of 100 and one group of 50). Groups of 5 or more individuals made up 5% of the Wood ducks, 16% of the Canada geese, 25% of the Mallards, 69% of the Blue-winged Teal and 38% of the "other ducks" of the total indicated birds for each species. Flocks of >19 birds are not included in BPOP estimates, as they are considered migrants or non-breeders. 

The `r params$year` population estimate for **all breeding ducks** is **`r all_results[1]` (95% CI: [`r all_results[2]`; `r all_results[3]`])**. This estimate is `r all_results[4]` `r all_results[5]` compared to the previous year and is `r all_results[6]` `r all_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_total_ducks}). 

The `r params$year` population estimate for **Mallards** is **`r mall_results[1]` (95% CI: [`r mall_results[2]`; `r mall_results[3]`])**. This estimate is `r mall_results[4]` `r mall_results[5]` compared to the previous year and is `r mall_results[6]` `r mall_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_mall}). 

The `r params$year` population estimate for **Blue-winged teal** is **`r bwte_results[1]` (95% CI: [`r bwte_results[2]`; `r bwte_results[3]`])**. This estimate is `r bwte_results[4]` `r bwte_results[5]` compared to the previous year and is `r bwte_results[6]` `r bwte_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_bwte}). 

The `r params$year` population estimate for **Wood ducks** is **`r wodu_results[1]` (95% CI: [`r wodu_results[2]`; `r wodu_results[3]`])**. This estimate is `r wodu_results[4]` `r wodu_results[5]` compared to the previous year and is `r wodu_results[6]` `r wodu_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_wodu}). 

The `r params$year` population estimate for **Canada geese** is **`r cago_results[1]` (95% CI: [`r cago_results[2]`; `r cago_results[3]`])**. This estimate is a `r cago_results[4]` `r cago_results[5]` compared to the previous year and is `r cago_results[6]` `r cago_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_cago}).

The `r params$year` population estimate for **"other ducks"** is **`r other_results[1]` (95% CI: [`r other_results[2]`;`r other_results[3]`])**. This estimate is `r other_results[4]` `r other_results[5]` compared to the previous year and is `r other_results[6]` `r other_results[7]` than the long-term, `r params$year - 1973 - 1`-year mean (Figure \ref{fig:ssm_other_ducks}). 

## Coots, Cranes, and Swans  

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# these will be updated later to pull from a csv or .csv object
air_coot_count <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'coots', "_", analysis_year, '.csv')) %>% 
  slice_tail(n= 1) %>% 
  pull(coots)
air_crane_count <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'cranes', "_", analysis_year, '.csv')) %>% 
  slice_tail(n = 1)
air_swan_count <- read_csv(str_c(here::here('output'), '/', analysis_year, '/', 'trumpeter_swans', "_", analysis_year, '.csv')) %>% 
  slice_tail(n = 1) %>% 
  pull(seen_birds_Pop)
```

I conducted summary counts of American coots, Sandhill cranes (Figure \ref{fig:annual_crane_counts}), as well as Trumpeter swans (Figure \ref{fig:ssm_trsw}) for `r params$year`. Prior to 2019, these counts included all birds counted on the air and ground transects. Here, I present only those individuals counted on the air transects to avoid double counting. 

Air observers counted a total of `r air_coot_count` coots in `r params$year`. Air observed Sandhill cranes totaled `r air_crane_count$cranes_total` in `r params$year`. Excluding groups greater than 5 (signifying migrant or non-breeding individuals), counts totaled `r air_crane_count$cranes_no_groups` individuals. One pair of Whooping cranes were observed on transect 3 in `r params$year`. Excluding groups of five or more, the number of **Trumpeter swans** counted towards the statewide population estimate was `r air_swan_count` in `r params$year`. The `r params$year` population estimate for **Trumpeter swans** is **`r swan_results[1]` (95% CI: [`r swan_results[2]`; `r swan_results[3]`])** (Table \ref{tab:trump_tab}); Figure \ref{fig:ssm_trsw}).  

## Opportunities for future analyses

Opportunities exist for further analyses that explore improved ways to handle stochastic variations in annual VCF estimates for each priority species. Comparative analyses that evaluate overall changes on survey abundance estimates with alternative methods to derive VCFs would be useful to inform future directions. Options could include using a fixed VCF across all years, a rolling average VCF, or a VCF using only the current year of survey data. Similar research was recently completed in Michigan and found comparable survey estimates across multiple VCF alternatives (Yost 2020). 
	
Opportunities also exist for improved data visualization and communication of the spring survey data. Technological infrastructure exists to support an online, interactive display of available data and the public report itself. Much more data are available than currently included in the public report and creating an online data dashboard (example here: https://flexdashboard-pkg.netlify.app/articles/examples.html) would increase the capacity to house and display survey metrics.  

\newpage

## Literature cited

<div id="refs"></div>

\newpage

## Tables

```{r tables, child = here::here("scripts/rmarkdown/internal_report_tables.Rmd")}
```

\newpage

## Figures

```{r figures, child = here::here("scripts/rmarkdown/internal_report_figures.Rmd")}
```
